<!doctype html><html><head><title>Enhancing stock data for your Python Algorithmic Trading Model</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="index, follow"><meta name=description content="The typical machine learning algorithm can only work with the data it got. It (usually) can not create new features or interpretations like &#34;If volume increases and the 3rd derivative of price rises, the price will most likely go up&#34;, but instead can only &#34;look&#34; at the data it got. These would be calculations like &#34;if the price is above 100 USD, and the volume above 2000, the price will most likely go up&#34;."><link rel=canonical href=https://datafortress.cloud/blog/enhancing-stock-data-for-your-python-algorithmic-trading-model/><link rel=alternate href=https://datafortress.cloud/blog/enhancing-stock-data-for-your-python-algorithmic-trading-model/ hreflang=en-us><link rel=icon type=image/png href=https://datafortress.cloud/images/logo.webp><meta property="og:title" content="Enhancing stock data for your Python Algorithmic Trading Model"><meta property="og:description" content="The typical machine learning algorithm can only work with the data it got. It (usually) can not create new features or interpretations like &#34;If volume increases and the 3rd derivative of price rises, the price will most likely go up&#34;, but instead can only &#34;look&#34; at the data it got. These would be calculations like &#34;if the price is above 100 USD, and the volume above 2000, the price will most likely go up&#34;."><meta property="og:type" content="article"><meta property="og:url" content="https://datafortress.cloud/blog/enhancing-stock-data-for-your-python-algorithmic-trading-model/"><meta property="article:section" content="blog"><meta property="article:published_time" content="2022-01-26T23:00:00+00:00"><meta property="article:modified_time" content="2022-07-07T21:15:36+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Enhancing stock data for your Python Algorithmic Trading Model"><meta name=twitter:description content="The typical machine learning algorithm can only work with the data it got. It (usually) can not create new features or interpretations like &#34;If volume increases and the 3rd derivative of price rises, the price will most likely go up&#34;, but instead can only &#34;look&#34; at the data it got. These would be calculations like &#34;if the price is above 100 USD, and the volume above 2000, the price will most likely go up&#34;."><script type=application/ld+json>{"@context":"https://schema.org/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/datafortress.cloud\/blog\/enhancing-stock-data-for-your-python-algorithmic-trading-model\/"},"headline":"Enhancing stock data for your Python Algorithmic Trading Model","description":"The typical machine learning algorithm can only work with the data it got. It (usually) can not create new features or interpretations like \u0022If volume increases and the 3rd derivative of price rises, the price will most likely go up\u0022, but instead can only \u0022look\u0022 at the data it got. These would be calculations like \u0022if the price is above 100 USD, and the volume above 2000, the price will most likely go up\u0022.","image":[],"datePublished":"2022-01-26T23:00:00\u002b00:00","dateModified":"2022-07-07T21:15:36\u002b02:00","author":{"@type":"Person","name":"Justin Guese"},"publisher":{"@type":"Organization","name":"Datafortress.cloud","logo":{"@type":"ImageObject","url":"https:\/\/datafortress.cloud\/images\/logo.webp"}}}</script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.4/css/bulma.min.css><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.13.1/css/all.css integrity=sha384-xxzQGERXS00kBmZW/6qxqJPyxW3UR0BPsL4c8ILaIWXva5kFi7TxkIIaMiKtqV1Q crossorigin=anonymous><link rel=stylesheet href=https://datafortress.cloud//css/style.css><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js></script></head><body><header><nav class=navbar><div class=navbar-brand><a class=navbar-item href=https://datafortress.cloud/ title=Datafortress.cloud><img src=https://datafortress.cloud/images/logo.webp alt="VR, Big-Data and Cloud for your Business."></a>
<a href=https://datafortress.cloud/ title="VR, Big-Data and Cloud for your Business." class=navbar-item><span class=is-size-4>Datafortress.cloud</span></a>
<a href=https://datafortress.cloud/contact class=navbar-item title="RSS feed"><span class="icon fa-lg has-text-dark"><i class="fa fa-envelope"></i></span></a>
<a href=https://datafortress.cloud/index.xml class=navbar-item title="RSS feed"><span class="icon fa-lg has-text-dark"><i class="fa fa-rss"></i></span></a>
<a role=button class=navbar-burger aria-label=menu aria-expanded=false><span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span></a></div><div class="navbar-menu navbar-end"><a href=https://datafortress.cloud/products class=navbar-item>Products</a>
<a href=https://datafortress.cloud/services class=navbar-item>Services</a>
<a href=https://datafortress.cloud/project class=navbar-item>Portfolio</a>
<a href=https://datafortress.cloud/blog class=navbar-item>Blog</a>
<a href=https://datafortress.cloud/contact class=navbar-item>Contact</a>
<a href=https://datafortress.cloud/ class=navbar-item>about</a></div></nav><script>$(document).ready(function(){$(".navbar-burger").click(function(){$(".navbar-burger").toggleClass("is-active"),$(".navbar-menu").toggleClass("is-active")})})</script></header><main><article><div class="columns is-centered"><div class="column max-800px"><section class=section><h1 class="title is-2">Enhancing stock data for your Python Algorithmic Trading Model</h1><div class="columns is-tablet"><div class="columns is-mobile"><div class="column is-narrow"><figure class="image is-64x64"><img class=is-rounded src=https://datafortress.cloud/images/logo.webp alt="Justin Guese" title="Justin Guese"></figure></div><div class=column><p>Justin Guese |
<time datetime=2022-01-26>26 January 2022</time><br><time datetime=2022-07-07><span class=has-text-grey-light>Last Updated | 7 July 2022</span></time><br><span class=has-text-grey-light>1493 words | 8 minutes</span></p></div></div></div><div class="tags is-pulled-left"><a class="tag is-primary" href=https://datafortress.cloud/categories/finance/>finance</a>
<a class="tag is-primary" href=https://datafortress.cloud/categories/algorithmic-trading/>algorithmic trading</a></div><div class="tags is-pulled-right"><a class="tag is-info" href=https://datafortress.cloud/tags/ai-investing/>ai investing</a>
<a class="tag is-info" href=https://datafortress.cloud/tags/investing/>investing</a>
<a class="tag is-info" href=https://datafortress.cloud/tags/stocks/>stocks</a>
<a class="tag is-info" href=https://datafortress.cloud/tags/finance/>finance</a>
<a class="tag is-info" href=https://datafortress.cloud/tags/algorithmic-trading/>algorithmic trading</a></div></section><section class=content><h1 id=your-first-steps-building-a-trading-algorithm>Your first steps building a trading algorithm</h1><p>Let us say you are planning to build your own algorithmic trading model.</p><p>You will most likely use only price (Close) data for your model and algorithm, but soon you will discover, that your model does not perform well.</p><p>Soon you will use typical OHLCV data, which refers to Open, High, Low, Close, Volume, which is already better, but the model does not seem to perform quite well enough.</p><p>What can you do?</p><p>Handy Colab Notebook to follow along: <a href="https://colab.research.google.com/drive/1ywqti1TuTDY_Z11ry0x4ITclCwxnXAeI?usp=sharing" title="https://colab.research.google.com/drive/1ywqti1TuTDY_Z11ry0x4ITclCwxnXAeI?usp=sharing">https://colab.research.google.com/drive/1ywqti1TuTDY_Z11ry0x4ITclCwxnXAeI?usp=sharing</a></p><p>Gist:</p><p><a href=https://gist.github.com/JustinGuese/019e0e71100abe6555f78c32fd0b10a9 title=https://gist.github.com/JustinGuese/019e0e71100abe6555f78c32fd0b10a9>https://gist.github.com/JustinGuese/019e0e71100abe6555f78c32fd0b10a9</a></p><h2 id=what-does-a-machine-learning-trading-bot-like>What does a Machine Learning Trading Bot like?</h2><p>The typical machine learning algorithm can only work with the data it got. It (usually) can not create new features or interpretations like &ldquo;If volume increases and the 3rd derivative of price rises, the price will most likely go up&rdquo;, but instead can only &ldquo;look&rdquo; at the data it got. These would be calculations like &ldquo;if the price is above 100 USD, and the volume above 2000, the price will most likely go up&rdquo;.</p><p>Newcomers to Machine Learning are now trying to solve this problem by training for decades, or using more and more GPUs, but a way more efficient way would be to feed that algorithm with additional data, such that it can use more resources to infer it&rsquo;s calculations.</p><p>This can be achieved by:</p><ol><li>Getting more data (a bigger timespan)</li><li>Adding statistical metrics</li><li>Adding your own signals and interpretations</li></ol><h1 id=hands-on-enhancing-your-data>Hands-on: Enhancing your data</h1><h2 id=first-steps---getting-your-data>First steps - Getting your data</h2><p>First, let us grab some basic OHLCV data. I like the yfinance (<a href=https://pypi.org/project/yfinance/ title=https://pypi.org/project/yfinance/>https://pypi.org/project/yfinance/</a>) module for its simplicity. It is not comparable to live-streams of data, but on the other hand, it&rsquo;s free and great for experimentation!</p><pre><code>pip install yfinance pandas numpy matplotlib ta
</code></pre><p>Import that module as well as Pandas Numpy Matplotlib</p><pre><code>import yfinance as yf
import matplotlib.pyplot as plt
import pandas as pd
</code></pre><p>Get some stock data, interval and period refer to the timeranges.</p><p>interval accepts values like 1m,2m,5m,15m,30m,60m,90m,1h,1d,5d,1wk,1mo,3mo</p><p>period accepts values like 1d,5d,1mo,3mo,6mo,1y,2y,5y,10y,ytd,max</p><p>Not all combinations work, like 1m (1 Minute) intervals are only working with 7d max, 1h (1 hour) with 3 months max (needs to be written as 90d). But let&rsquo;s work with daily data first</p><pre><code>df = yf.download(&quot;MSFT&quot;,period=&quot;5y&quot;,interval=&quot;1d&quot;)
df.head()
</code></pre><p><img src=/images/screenshot-from-2021-01-27-14-46-45.png alt></p><p>Quick excourse: What the heck is Open, High, Low, Close, Adj Close, and Volume? Where is the price?!</p><p>There is no &ldquo;one price&rdquo; in the stock market! You can imagine OHLCV data as &ldquo;buckets&rdquo; or &ldquo;bins&rdquo; in time, summarizing all the trades that occurred in that window. The typical &ldquo;line&rdquo; chart you know usually refers to the &ldquo;Close&rdquo; price of that stock in time range X, e.g. the value the stock had at the close of the time range.</p><p>If we are looking at daily data, &ldquo;Open&rdquo; refers to the average (!) stock price at open of the markets, whilst &ldquo;Close&rdquo; refers to the average (!) price the stock had at the close of markets. If looking at hourly data, the &ldquo;Open&rdquo; refers to the beginning of that hour, like 11 am, and the &ldquo;Close&rdquo; to the close of that hour, so 11:59:59 am.</p><p>Equally &ldquo;High&rdquo; is the highest trade/price recorded in that time frame, and &ldquo;Low&rdquo; the lowest one. Volume refers to the number of assets or stocks traded in that time range.</p><p>Meaning if e.g. &ldquo;Low&rdquo; and &ldquo;Close&rdquo; of a column are close to each other, we are most likely seeing a downwards trend as the close is the current low. Also if Volume is high, there is a lot of trades going on, so if e.g. the Volume is higher than usual there seems to be something going on in the market. But anyway, head over to <a href=https://www.investopedia.com/ title=https://www.investopedia.com/>https://www.investopedia.com/</a> for that, we will continue coding now!</p><h3 id=what-is-adj-close>What is &ldquo;Adj Close&rdquo;?</h3><p>This is important, as most ML algorithms are terribly confused by &ldquo;normal&rdquo; close-data. If there is a split in the stock, the data will look like the price has an insane drop.</p><p>The reason is, simply said, that if a stock get&rsquo;s too expensive, the company decides to &ldquo;split&rdquo; the stock in two. Does that mean my investment halves? Of course not, you will simply get double the stocks you are holding, so on paper you still hold the same value of that stock.</p><p>Interestingly a split usually causes prices to rise (silly humans!), and if your machine learning algorithm sees a huge drop in price it will most likely sell the hell out of that stock.</p><p>For this reason, you should always use &ldquo;adjusted&rdquo; values, which can be imagined as &ldquo;cleaned&rdquo; price data, keeping in mind the splits, dividends, and all other events not affecting the true value of data. Therefore try to always use adjusted data for your algorithms!</p><p>In the case of yfinance it is easy to do, as we can just use &ldquo;Adj Close&rdquo; instead of &ldquo;Close&rdquo;.</p><h3 id=plotting-the-data>Plotting the data</h3><p>Looking at the data we can already see a nice, well-known curve</p><pre><code>plt.plot(df[&quot;Adj Close&quot;])
</code></pre><h2 id=step-two-enhancing-your-data-with-statistical-data>Step two: Enhancing your data with statistical data</h2><p>As said above, we need to create more information from our data for the algorithm to use, as it can not do this on its own.</p><p>I like to use the library ta (<a href=https://github.com/bukosabino/ta title=https://github.com/bukosabino/ta>https://github.com/bukosabino/ta</a>) as again, it is super easy to use and contains 100+ statistical calculations.</p><p>Install and import it with</p><pre><code>pip install ta
from ta import add_all_ta_features
from ta.utils import dropna
</code></pre><p>Now if you already know which values you want to use you can only pick these, oooor we just smash all 100+ at our data:</p><pre><code>df = dropna(df) # clean nans if present
df = add_all_ta_features(df,open=&quot;Open&quot;, high=&quot;High&quot;, low=&quot;Low&quot;, close=&quot;Adj Close&quot;, volume=&quot;Volume&quot;)
</code></pre><p>So what have we done?</p><pre><code>df.columns
Index(['Open', 'High', 'Low', 'Close', 'Adj Close', 'Volume', 'volume_adi',
       'volume_obv', 'volume_cmf', 'volume_fi', 'volume_mfi', 'volume_em',
       'volume_sma_em', 'volume_vpt', 'volume_nvi', 'volume_vwap',
       'volatility_atr', 'volatility_bbm', 'volatility_bbh', 'volatility_bbl',
       'volatility_bbw', 'volatility_bbp', 'volatility_bbhi',
       'volatility_bbli', 'volatility_kcc', 'volatility_kch', 'volatility_kcl',
       'volatility_kcw', 'volatility_kcp', 'volatility_kchi',
       'volatility_kcli', 'volatility_dcl', 'volatility_dch', 'volatility_dcm',
       'volatility_dcw', 'volatility_dcp', 'volatility_ui', 'trend_macd',
       'trend_macd_signal', 'trend_macd_diff', 'trend_sma_fast',
       'trend_sma_slow', 'trend_ema_fast', 'trend_ema_slow', 'trend_adx',
       'trend_adx_pos', 'trend_adx_neg', 'trend_vortex_ind_pos',
       'trend_vortex_ind_neg', 'trend_vortex_ind_diff', 'trend_trix',
       'trend_mass_index', 'trend_cci', 'trend_dpo', 'trend_kst',
       'trend_kst_sig', 'trend_kst_diff', 'trend_ichimoku_conv',
       'trend_ichimoku_base', 'trend_ichimoku_a', 'trend_ichimoku_b',
       'trend_visual_ichimoku_a', 'trend_visual_ichimoku_b', 'trend_aroon_up',
       'trend_aroon_down', 'trend_aroon_ind', 'trend_psar_up',
       'trend_psar_down', 'trend_psar_up_indicator',
       'trend_psar_down_indicator', 'trend_stc', 'momentum_rsi',
       'momentum_stoch_rsi', 'momentum_stoch_rsi_k', 'momentum_stoch_rsi_d',
       'momentum_tsi', 'momentum_uo', 'momentum_stoch',
       'momentum_stoch_signal', 'momentum_wr', 'momentum_ao', 'momentum_kama',
       'momentum_roc', 'momentum_ppo', 'momentum_ppo_signal',
       'momentum_ppo_hist', 'others_dr', 'others_dlr', 'others_cr'],
      dtype='object')
</code></pre><p>Well, that should be enough for now!</p><p>Also, there is still a lot of nans in there, as some values are only calculated if enough time passed. In my experience filling them with zeros works quite well, even though there are more advanced techniques for that.</p><pre><code>df = df.fillna(0)
</code></pre><h2 id=step-three-creating-your-own-signals>Step three: Creating your own signals</h2><p>Now it is time to translate your weird trade ideas into numbers!</p><p>Let us start with the classic Moving Average cross. The idea is as follows: If a short moving average crosses a slower moving average, it either indicates a price rise or fall, depending on the direction of the cross.</p><p>Again, have a look at investopedia for details: <a href=https://www.investopedia.com/articles/active-trading/052014/how-use-moving-average-buy-stocks.asp title=https://www.investopedia.com/articles/active-trading/052014/how-use-moving-average-buy-stocks.asp>https://www.investopedia.com/articles/active-trading/052014/how-use-moving-average-buy-stocks.asp</a></p><p>Our goal is to first calculate the SMA&rsquo;s, and then to formulate crosses as 1 and -1, and 0 to signal no cross.</p><h3 id=creating-simple-moving-averages>Creating Simple Moving Averages</h3><pre><code># creating simple moving averages
averages = [1,2,5,10,15,20,25,50,100]
for average in averages:
  df['SMA_%d'%average] = df[&quot;Adj Close&quot;].rolling(window=average).mean()

# visualize only SMAs 
filter_col = [col for col in df if col.startswith('SMA')]
df[filter_col].tail()
</code></pre><p>And some visualization:</p><pre><code># results in bigger figures
plt.rcParams[&quot;figure.figsize&quot;] = (20,20)
for filter in filter_col:
  plt.plot(df[filter],label=filter)
plt.legend()
</code></pre><p><img src=/images/download.png alt="SMA python trading" title="Image by author"></p><h3 id=creating-a-crossover-signal>Creating a crossover signal</h3><p>Let us use a little helper function</p><pre><code>def createCross(data,fastSMA,slowSMA):
  fast = 'SMA_%d'%fastSMA
  slow = 'SMA_%d'%slowSMA
  crossname = &quot;cross_%d_%d&quot;%(fastSMA,slowSMA)
  previous_fast = data[fast].shift(1)
  previous_slow = data[slow].shift(1)
  neg = ((data[fast] &lt; data[slow]) &amp; (previous_fast &gt;= previous_slow))
  pos = ((data[fast] &gt; data[slow]) &amp; (previous_fast &lt;= previous_slow))
  data[crossname] = 0
  data.loc[neg,crossname] = -1
  data.loc[pos,crossname] = 1
  return data
</code></pre><p>And now you could either insert custom values or follow our example and just take the cross products:</p><pre><code>for fast in averages:
  for slow in averages:
    if fast != slow and slow &gt; fast:
      df = createCross(df,fast,slow)
</code></pre><p>This created a perfect classification signal signaling an upwards cross with 1, and a downwards cross with -1, with 0 being a neutral (no-cross).</p><p>This is just one example of what further signals you can provide.</p><h3 id=creating-a-percentage-change-column>Creating a percentage change column</h3><p>And to add another example, if you are trying to predict the percentage change you will need a column showing the percentage change to the previous time range. This can luckily be easily done using pandas.</p><pre><code>df[&quot;pct_change&quot;] = df[&quot;Adj Close&quot;].pct_change()

Date
2021-01-21    0.013363
2021-01-22   -0.004463
2021-01-25    0.000538
2021-01-26    0.009754
2021-01-27   -0.010484
Name: pct_change, dtype: float64
</code></pre><p>What a perfect signal for a regressional model!</p><h1 id=summary>Summary</h1><p>Before we added our enhancements the dataframe just contained 5 columns, not much for a machine learning model!</p><p>In the end, after adding statistical values and our own signals, we already reached 135 features and columns of our dataframe!</p><p>So much better for your model!</p><p>What are your thoughts about this process? Did I miss something? Comment below!<br>Do you want to read more articles by Justin? Head over to my website for more!</p></section></div></div></article><aside class="columns is-centered"><div class="column max-800px"><div class=content><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//datafortess-cloud.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></aside></main><footer class=footer><div class="columns has-text-centered"><div class="column is-one-third is-narrow"><p>Social media</p></div><div class="column is-one-third is-narrow"><i class='fab fa-creative-commons' aria-hidden=true></i> This work is licensed under a <a rel=license href=https://creativecommons.org/licenses/by-sa/4.0/ target=_blank>Creative Commons Attribution-ShareAlike 4.0 International</a> License.</div><div class="column is-one-third is-narrow"><p>Powered by</p><a href=https://gohugo.io/ target=_blank><img src=https://datafortress.cloud/images/hugo-logo.png alt=Hugo width=64 height=12 title="Powered by Hugo"></a> &nbsp; &nbsp;
<a href=https://bulma.io/ target=_blank><img src=https://datafortress.cloud/images/made-with-bulma.png alt=Bulma width=64 height=16 title="Powered by Bulma CSS"></a>&nbsp; &nbsp;
<a href=https://www.gnu.org/software/emacs/ target=_blank><img src=https://datafortress.cloud/images/emacs-logo.png alt=Emacs width=16 height=16 title="Written in Emacs"></a></div></div></footer></body></html>